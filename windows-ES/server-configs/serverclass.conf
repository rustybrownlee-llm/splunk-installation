# HAP Deployment Server Configuration
# Install on: Server 1 (ES Search Head / Deployment Server)
# Location: C:\Program Files\Splunk\etc\system\local\serverclass.conf
#
# This file controls which apps are deployed to which forwarders

#========================================
# Global Settings
#========================================
[global]
# By default, don't deploy to anyone
whitelist.0 = *
# Disable by default, enable per-server class
disabled = false

#========================================
# Server Class: ALL Forwarders
# Apps deployed to every forwarder regardless of OS
#========================================
[serverClass:AllForwarders]
# Match all forwarders
whitelist.0 = *
# No machine type filter (applies to all OS)

# Deployment Client Config - Connects to deployment server
[serverClass:AllForwarders:app:hap_add-on_deployment]
restartSplunkd = true
stateOnClient = enabled

# Outputs Config - Sends data to Server 2
[serverClass:AllForwarders:app:hap_add-on_outputs]
restartSplunkd = true
stateOnClient = enabled

#========================================
# Server Class: Windows Forwarders
# Apps deployed ONLY to Windows endpoints
#========================================
[serverClass:WindowsForwarders]
# Match all hostnames
whitelist.0 = *
# Filter by Windows OS types
machineTypesFilter = windows-x64, windows-intel

# Windows Event Log and Perfmon Collection
[serverClass:WindowsForwarders:app:hap_add-on_windows_inputs]
restartSplunkd = true
stateOnClient = enabled

#========================================
# Server Class: Linux Forwarders (if needed)
# Apps deployed ONLY to Linux endpoints
#========================================
[serverClass:LinuxForwarders]
# Match all hostnames
whitelist.0 = *
# Filter by Linux OS types
machineTypesFilter = linux-x86_64, linux-aarch64
# Currently no Linux-specific apps defined

#========================================
# Server Class: Cisco Cyber Vision Forwarders
# Apps deployed ONLY to forwarders with Cyber Vision sensors
#========================================
[serverClass:CyberVisionForwarders]
# Match forwarders with Cyber Vision sensors using naming convention
whitelist.0 = CYBERVISION-*
whitelist.1 = ICS-*
whitelist.2 = OT-*
# Or use specific hostnames:
# whitelist.0 = SCADA-FWD01
# whitelist.1 = ICS-SENSOR01

# Cyber Vision Index Override - Routes data to cybervision index
# Requires: TA-cisco_cybervision installed manually on forwarder first
[serverClass:CyberVisionForwarders:app:hap_add-on_cybervision_inputs]
restartSplunkd = true
stateOnClient = enabled

#========================================
# Optional: Server Class by Environment
# Deploy different configs to prod vs. test
#========================================
# [serverClass:Production]
# whitelist.0 = PROD-*
# whitelist.1 = P-*
# [serverClass:Production:app:hap_add-on_outputs]
# # Override outputs to production indexer
#
# [serverClass:Test]
# whitelist.0 = TEST-*
# whitelist.1 = T-*
# [serverClass:Test:app:hap_add-on_outputs]
# # Override outputs to test indexer

#========================================
# Optional: Server Class by Location
# Different apps for different sites
#========================================
# [serverClass:Site_HQ]
# whitelist.0 = HQ-*
#
# [serverClass:Site_Branch]
# whitelist.0 = BRANCH-*

#========================================
# Optional: Server Class for Domain Controllers
# Additional event logs for DCs
#========================================
# [serverClass:DomainControllers]
# whitelist.0 = DC-*
# machineTypesFilter = windows-x64
#
# [serverClass:DomainControllers:app:hap_add-on_dc_inputs]
# restartSplunkd = true
# stateOnClient = enabled

#========================================
# Optional: Server Class for IIS Web Servers
# IIS log collection
#========================================
# [serverClass:WebServers]
# whitelist.0 = WEB-*
# whitelist.1 = IIS-*
# machineTypesFilter = windows-x64
#
# [serverClass:WebServers:app:hap_add-on_iis_inputs]
# restartSplunkd = true
# stateOnClient = enabled

#========================================
# Optional: Server Class for Specific Hosts
# Target individual machines
#========================================
# [serverClass:CriticalServers]
# whitelist.0 = SQLSERVER01
# whitelist.1 = EXCHSERVER01
# whitelist.2 = FILESERVER01
#
# [serverClass:CriticalServers:app:hap_add-on_enhanced_monitoring]
# restartSplunkd = true
# stateOnClient = enabled

#========================================
# Optional: Blacklist Examples
# Exclude specific hosts from receiving apps
#========================================
# [serverClass:AllForwarders]
# whitelist.0 = *
# blacklist.0 = TEST-*
# blacklist.1 = DECOM-*

#========================================
# Notes:
#
# machineTypesFilter Options:
#   - windows-x64, windows-intel (Windows)
#   - linux-x86_64, linux-aarch64 (Linux)
#   - darwin-i386, darwin-x86_64 (macOS)
#
# Whitelist/Blacklist:
#   - Use wildcards (*) for pattern matching
#   - Use regex for complex patterns
#   - Blacklist takes precedence over whitelist
#
# Restart Behavior:
#   - restartSplunkd = true: Restart forwarder when app deployed (required for config changes)
#   - restartSplunkd = false: No restart (use for dashboards, lookups)
#
# State:
#   - stateOnClient = enabled: App is enabled on forwarder
#   - stateOnClient = disabled: App is disabled on forwarder
#   - stateOnClient = noop: Don't manage app state
#
# Reload Deployment Server:
#   After editing this file, reload deployment server:
#   cd "C:\Program Files\Splunk\bin"
#   .\splunk reload deploy-server -auth admin:password
#
# List Deployment Clients:
#   .\splunk list deploy-clients -auth admin:password
#
# Test Server Class Matching:
#   .\splunk list deploy-clients -class AllForwarders -auth admin:password
#   .\splunk list deploy-clients -class WindowsForwarders -auth admin:password
#========================================

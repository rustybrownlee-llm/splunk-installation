# HAP Windows Inputs Configuration
# Deployed to: Windows forwarders ONLY (via serverclass OS filter)
#
# Collects Windows Event Logs, Performance Monitoring, and Sysmon data

#========================================
# Windows Event Logs - Security
#========================================
[WinEventLog://Security]
disabled = false
index = wineventlog
sourcetype = WinEventLog:Security
# Render XML for better field extraction
renderXml = true
# Collect from beginning (don't miss events)
start_from = oldest

[WinEventLog://System]
disabled = false
index = wineventlog
sourcetype = WinEventLog:System
renderXml = true
start_from = oldest

[WinEventLog://Application]
disabled = false
index = wineventlog
sourcetype = WinEventLog:Application
renderXml = true
start_from = oldest

#========================================
# Windows Event Logs - Advanced
#========================================
# PowerShell Logging (requires Group Policy to enable)
[WinEventLog://Microsoft-Windows-PowerShell/Operational]
disabled = false
index = wineventlog
sourcetype = WinEventLog:PowerShell
renderXml = true

[WinEventLog://Windows PowerShell]
disabled = false
index = wineventlog
sourcetype = WinEventLog:WindowsPowerShell
renderXml = true

# Windows Firewall
[WinEventLog://Microsoft-Windows-Windows Firewall With Advanced Security/Firewall]
disabled = false
index = wineventlog
sourcetype = WinEventLog:Firewall
renderXml = true

# Windows Defender (if installed)
[WinEventLog://Microsoft-Windows-Windows Defender/Operational]
disabled = false
index = endpoint
sourcetype = WinEventLog:Defender
renderXml = true

# Task Scheduler
[WinEventLog://Microsoft-Windows-TaskScheduler/Operational]
disabled = false
index = wineventlog
sourcetype = WinEventLog:TaskScheduler
renderXml = true

# Windows Updates
[WinEventLog://Setup]
disabled = false
index = wineventlog
sourcetype = WinEventLog:Setup
renderXml = true

#========================================
# Sysmon (requires Sysmon installation)
#========================================
# Sysmon provides detailed process, network, and file monitoring
# Install Sysmon: https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon
[WinEventLog://Microsoft-Windows-Sysmon/Operational]
disabled = false
index = endpoint
sourcetype = XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
renderXml = true
# Sysmon can be VERY chatty, consider filtering if needed

#========================================
# Performance Monitoring (Perfmon)
#========================================

# CPU Performance
[perfmon://CPU]
object = Processor
counters = % Processor Time; % User Time; % Privileged Time; % Idle Time
instances = _Total
interval = 60
disabled = false
index = perfmon
mode = single

# Memory Performance
[perfmon://Memory]
object = Memory
counters = Available Bytes; Pages/sec; % Committed Bytes In Use; Commit Limit; Committed Bytes
instances = *
interval = 60
disabled = false
index = perfmon
mode = single

# Disk Performance
[perfmon://LogicalDisk]
object = LogicalDisk
counters = % Free Space; Free Megabytes; Current Disk Queue Length; % Disk Time; Avg. Disk Queue Length; Avg. Disk Read Queue Length; Avg. Disk Write Queue Length
instances = *
interval = 60
disabled = false
index = perfmon
mode = single

[perfmon://PhysicalDisk]
object = PhysicalDisk
counters = Avg. Disk sec/Read; Avg. Disk sec/Write; Avg. Disk Read Queue Length; Avg. Disk Write Queue Length
instances = *
interval = 60
disabled = false
index = perfmon
mode = single

# Network Performance
[perfmon://Network]
object = Network Interface
counters = Bytes Total/sec; Packets/sec; Packets Received/sec; Packets Sent/sec; Current Bandwidth
instances = *
interval = 60
disabled = false
index = perfmon
mode = single

# System Performance
[perfmon://System]
object = System
counters = Processor Queue Length; Context Switches/sec; System Calls/sec
instances = *
interval = 60
disabled = false
index = perfmon
mode = single

# Process Performance (Top CPU consumers)
[perfmon://Process]
object = Process
counters = % Processor Time; % User Time; Private Bytes; Working Set; Virtual Bytes
instances = *
interval = 300
disabled = false
index = perfmon
mode = single

#========================================
# DNS Client Logs (requires DNS logging enabled)
#========================================
[WinEventLog://Microsoft-Windows-DNS-Client/Operational]
disabled = false
index = dns
sourcetype = WinEventLog:DNS-Client
renderXml = true

#========================================
# Optional: Active Directory Logs
# (Only enable on Domain Controllers)
#========================================
# [WinEventLog://Directory Service]
# disabled = true
# index = wineventlog
# sourcetype = WinEventLog:DirectoryService
# renderXml = true

# [WinEventLog://DFS Replication]
# disabled = true
# index = wineventlog
# sourcetype = WinEventLog:DFS
# renderXml = true

#========================================
# Optional: IIS Logs
# (Only enable on web servers)
#========================================
# [monitor://C:\inetpub\logs\LogFiles]
# disabled = true
# index = web
# sourcetype = iis
# crcSalt = <SOURCE>

#========================================
# Host-Level Metadata
#========================================
# Add host metadata for asset correlation in ES
[default]
host = $decideOnStartup
